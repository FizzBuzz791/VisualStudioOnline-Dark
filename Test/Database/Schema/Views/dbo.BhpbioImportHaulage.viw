IF OBJECT_ID('dbo.BhpbioImportHaulage') IS NOT NULL 
     DROP VIEW dbo.BhpbioImportHaulage
GO

CREATE VIEW dbo.BhpbioImportHaulage
AS
SELECT r.ImportSyncRowId,
	r.SourceRow.value('(//HaulageSource/Haulage/HaulageDate)[1]', 'DATETIME') AS HaulageDate,
	r.SourceRow.value('(//HaulageSource/Haulage/HaulageShift)[1]', 'CHAR(1)') AS HaulageShift,
	r.SourceRow.value('(//HaulageSource/Haulage/Source)[1]', 'VARCHAR(63)') AS Source,
	r.SourceRow.value('(//HaulageSource/Haulage/SourceMineSite)[1]', 'VARCHAR(2)') AS SourceMineSite,
	r.SourceRow.value('(//HaulageSource/Haulage/Destination)[1]', 'VARCHAR(63)') AS Destination,
	r.SourceRow.value('(//HaulageSource/Haulage/DestinationMineSite)[1]', 'VARCHAR(2)') AS DestinationMinesite,
	r.SourceRow.value('(//HaulageSource/Haulage/Tonnes)[1]', 'FLOAT') AS Tonnes,
	r.SourceRow.value('(//HaulageSource/Haulage/Loads)[1]', 'INT') AS Loads,
	r.SourceRow.value('(//HaulageSource/Haulage/Truck)[1]', 'VARCHAR(31)') AS Truck,
	r.SourceRow.value('(//HaulageSource/Haulage/Type)[1]', 'VARCHAR(255)') AS Type,
	r.DestinationRow.value('(//HaulageDestination/Haulage/HaulageRawId)[1]', 'INT') AS HaulageRawId,
	r.RootImportSyncRowId, r.IsCurrent
FROM dbo.ImportSyncRow AS r
	INNER JOIN dbo.Import AS i
		ON (r.ImportId = i.ImportId)
	INNER JOIN dbo.ImportSyncTable AS t
		ON (r.ImportSyncTableId = t.ImportSyncTableId)
WHERE i.ImportName = 'Haulage'
	AND t.Name = 'Haulage'
GO

GRANT SELECT ON dbo.BhpbioImportHaulage TO CoreReporting
GO
