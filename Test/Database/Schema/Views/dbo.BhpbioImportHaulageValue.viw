IF OBJECT_ID('dbo.BhpbioImportHaulageValue') IS NOT NULL 
     DROP VIEW dbo.BhpbioImportHaulageValue
GO

CREATE VIEW dbo.BhpbioImportHaulageValue
AS
SELECT r.ImportSyncRowId,
	r.SourceRow.value('(//HaulageSource/HaulageValue/HaulageDate)[1]', 'DATETIME') AS HaulageDate,
	r.SourceRow.value('(//HaulageSource/HaulageValue/HaulageShift)[1]', 'CHAR(1)') AS HaulageShift,
	r.SourceRow.value('(//HaulageSource/HaulageValue/Source)[1]', 'VARCHAR(63)') AS Source,
	r.SourceRow.value('(//HaulageSource/HaulageValue/SourceMineSite)[1]', 'VARCHAR(2)') AS SourceMineSite,
	r.SourceRow.value('(//HaulageSource/HaulageValue/Destination)[1]', 'VARCHAR(63)') AS Destination,
	r.SourceRow.value('(//HaulageSource/HaulageValue/DestinationMineSite)[1]', 'VARCHAR(2)') AS DestinationMinesite,
	r.SourceRow.value('(//HaulageSource/HaulageValue/Truck)[1]', 'VARCHAR(31)') AS Truck,
	r.SourceRow.value('(//HaulageSource/HaulageValue/Type)[1]', 'VARCHAR(255)') AS Type,
	r.SourceRow.value('(//HaulageSource/HaulageValue/FieldId)[1]', 'VARCHAR(31)') AS FieldId,
	r.SourceRow.value('(//HaulageSource/HaulageValue/Mine)[1]', 'VARCHAR(255)') AS Mine,
	r.SourceRow.value('(//HaulageSource/HaulageValue/Value)[1]', 'VARCHAR(255)') AS Value,
	r.DestinationRow.value('(//HaulageDestination/HaulageValue/HaulageRawId)[1]', 'INT') AS HaulageRawId,
	r.RootImportSyncRowId, r.IsCurrent
FROM dbo.ImportSyncRow AS r
	INNER JOIN dbo.Import AS i
		ON (r.ImportId = i.ImportId)
	INNER JOIN dbo.ImportSyncTable AS t
		ON (r.ImportSyncTableId = t.ImportSyncTableId)
WHERE i.ImportName = 'Haulage'
	AND t.Name = 'HaulageValue'
GO

GRANT SELECT ON dbo.BhpbioImportHaulageValue TO CoreReporting
GO
